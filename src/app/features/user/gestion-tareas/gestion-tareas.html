<div class="tareas-container">
  <div class="tareas-wrapper">
    <!-- Header -->
    <div class="tareas-header">
      <button class="btn-volver" (click)="volver()">
        ← Volver a Proyectos
      </button>
      <h1>Gestión de Tareas</h1>
      <p class="proyecto-nombre" *ngIf="proyecto">{{ proyecto.nombre }}</p>
    </div>

    <!-- Botón crear nueva tarea -->
    <div class="actions-bar" *ngIf="!mostrarFormulario">
      <button class="btn-nueva-tarea" (click)="mostrarFormCrear()">
        + Nueva Tarea
      </button>
    </div>

    <!-- Formulario de crear/editar tarea -->
    <div class="formulario-card" *ngIf="mostrarFormulario">
      <div class="card-header">
        <h2>{{ modoEdicion ? 'Editar Tarea' : 'Nueva Tarea' }}</h2>
        <button class="btn-cerrar" (click)="cancelarFormulario()">×</button>
      </div>

      <form (ngSubmit)="guardarTarea()" #tareaForm="ngForm">
        <div class="form-group">
          <label for="titulo">Título *</label>
          <input 
            type="text" 
            id="titulo" 
            [(ngModel)]="nuevaTarea.titulo" 
            name="titulo"
            required
            placeholder="Nombre de la tarea">
        </div>

        <div class="form-group">
          <label for="descripcion">Descripción</label>
          <textarea 
            id="descripcion" 
            [(ngModel)]="nuevaTarea.descripcion" 
            name="descripcion"
            rows="4"
            placeholder="Detalles de la tarea"></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="etiqueta">Etiqueta *</label>
            <select 
              id="etiqueta" 
              [(ngModel)]="nuevaTarea.idEtiqueta" 
              name="etiqueta"
              required>
              <option value="0" disabled>Seleccionar etiqueta</option>
              <option *ngFor="let etiqueta of etiquetas" [value]="etiqueta.id">
                {{ etiqueta.nombre }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="prioridad">Prioridad</label>
            <select id="prioridad" [(ngModel)]="nuevaTarea.prioridad" name="prioridad">
              <option value="baja">Baja</option>
              <option value="media">Media</option>
              <option value="alta">Alta</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="estado">Estado</label>
          <select id="estado" [(ngModel)]="nuevaTarea.estado" name="estado">
            <option value="pendiente">Pendiente</option>
            <option value="en_progreso">En Progreso</option>
            <option value="completada">Completada</option>
          </select>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancelar" (click)="cancelarFormulario()">
            Cancelar
          </button>
          <button type="submit" class="btn-guardar" [disabled]="!tareaForm.valid || cargando">
            {{ cargando ? 'Guardando...' : (modoEdicion ? 'Actualizar Tarea' : 'Crear Tarea') }}
          </button>
        </div>
      </form>
    </div>

    <!-- Lista de tareas -->
    <div class="tareas-grid" *ngIf="tareas.length > 0">
      <div class="tarea-card" *ngFor="let tarea of tareas">
        <div class="tarea-header">
          <div class="tarea-info">
            <h3>{{ tarea.titulo }}</h3>
            <span class="badge badge-etiqueta">{{ obtenerNombreEtiqueta(tarea.idEtiqueta) }}</span>
          </div>
          <button class="btn-eliminar-card" (click)="eliminarTarea(tarea.id)">×</button>
        </div>

        <p class="tarea-descripcion" *ngIf="tarea.descripcion">{{ tarea.descripcion }}</p>

        <div class="tarea-badges">
          <span class="badge badge-prioridad-{{ tarea.prioridad }}">
            {{ obtenerTextoPrioridad(tarea.prioridad) }}
          </span>
          <span class="badge badge-estado-{{ tarea.estado }}">
            {{ obtenerTextoEstado(tarea.estado) }}
          </span>
        </div>

        <div class="tarea-actions">
          <button class="btn-editar" (click)="editarTarea(tarea)">
            Editar
          </button>
          <button class="btn-eliminar" (click)="eliminarTarea(tarea.id)">
            Eliminar
          </button>
        </div>
      </div>
    </div>

    <!-- Empty state -->
    <div class="empty-state" *ngIf="tareas.length === 0 && !mostrarFormulario">
      <p>No hay tareas creadas para este proyecto</p>
      <button class="btn-crear-primera" (click)="mostrarFormCrear()">
        Crear primera tarea
      </button>
    </div>
  </div>
</div>