<div class="tareas-container">
  <div class="tareas-wrapper">
    <!-- Header -->
    <div class="tareas-header">
      <button class="btn-volver" (click)="volver()">
        ‚Üê Volver al Proyecto
      </button>
      <h1>Gesti√≥n de Tareas</h1>
      <p class="proyecto-nombre" *ngIf="proyecto">{{ proyecto.nombre }}</p>
    </div>

    <!-- Bot√≥n nueva tarea -->
    <div class="actions-bar" *ngIf="!mostrarFormulario">
      <button class="btn-nueva-tarea" (click)="mostrarFormNuevo()">
        Nueva Tarea
      </button>
    </div>

    <!-- Formulario -->
    <div class="formulario-card" *ngIf="mostrarFormulario">
      <div class="card-header">
        <h2>{{ tareaEditandoId ? 'Editar Tarea' : 'Nueva Tarea' }}</h2>
        <button class="btn-cerrar" (click)="cancelarFormulario()">√ó</button>
      </div>

      <form (ngSubmit)="guardarTarea()" #tareaFormElement="ngForm">
        <div class="form-group">
          <label for="titulo">T√≠tulo *</label>
          <input
            type="text"
            id="titulo"
            [(ngModel)]="tareaForm.titulo"
            name="titulo"
            placeholder="T√≠tulo de la tarea"
            required
          />
        </div>

        <div class="form-group">
          <label for="descripcion">Descripci√≥n</label>
          <textarea
            id="descripcion"
            [(ngModel)]="tareaForm.descripcion"
            name="descripcion"
            placeholder="Descripci√≥n detallada de la tarea"
            rows="4"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="prioridad">Prioridad</label>
            <select
              id="prioridad"
              [(ngModel)]="tareaForm.prioridad"
              name="prioridad"
              required
            >
              <option value="baja">Baja</option>
              <option value="media">Media</option>
              <option value="alta">Alta</option>
            </select>
          </div>

          <div class="form-group">
            <label for="estado">Estado</label>
            <select
              id="estado"
              [(ngModel)]="tareaForm.estado"
              name="estado"
              required
            >
              <option value="pendiente">Pendiente</option>
              <option value="en_progreso">En Progreso</option>
              <option value="completada">Completada</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="etiqueta">Etiqueta</label>
            <select
              id="etiqueta"
              [(ngModel)]="tareaForm.idEtiqueta"
              name="etiqueta"
            >
              <option [ngValue]="null">Sin etiqueta</option>
              <option *ngFor="let etiqueta of etiquetas" [ngValue]="etiqueta.id">
                {{ etiqueta.nombre }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="usuario">Asignar a</label>
            <select
              id="usuario"
              [(ngModel)]="tareaForm.idUsuario"
              name="usuario"
            >
              <option [ngValue]="null">Sin asignar</option>
              <option *ngFor="let usuario of usuarios" [ngValue]="usuario.id">
                {{ usuario.nombre }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancelar" (click)="cancelarFormulario()">
            Cancelar
          </button>
          <button type="submit" class="btn-guardar" [disabled]="!tareaFormElement.valid || cargando">
            {{ cargando ? 'Guardando...' : (tareaEditandoId ? 'Actualizar' : 'Crear Tarea') }}
          </button>
        </div>
      </form>
    </div>

    <!-- Grid de tareas -->
    <div class="tareas-grid" *ngIf="tareas.length > 0">
      <div class="tarea-card" *ngFor="let tarea of tareas">
        <div class="tarea-header">
          <div class="tarea-info">
            <h3>{{ tarea.titulo }}</h3>
            <span class="badge-etiqueta">
              {{ tarea.nombreEtiqueta }}
            </span>
          </div>
        </div>

        <p class="tarea-descripcion" *ngIf="tarea.descripcion">
          {{ tarea.descripcion }}
        </p>

        <div class="tarea-badges">
          <span class="badge badge-prioridad-{{ tarea.prioridad }}">
            {{ obtenerTextoPrioridad(tarea.prioridad) }}
          </span>
          <span class="badge badge-estado-{{ tarea.estado }}">
            {{ obtenerTextoEstado(tarea.estado) }}
          </span>
        </div>

        <!-- Mostrar asignaci√≥n -->
        <div class="tarea-asignacion" *ngIf="tarea.idUsuario">
          <p class="asignado-a">
            üë§ Asignado a: <strong>{{ tarea.nombreUsuario }}</strong>
          </p>
        </div>

        <div class="tarea-actions">
          <button class="btn-editar" (click)="editarTarea(tarea)">
            Editar
          </button>
          <button class="btn-eliminar" (click)="eliminarTarea(tarea.id)">
            Eliminar
          </button>
        </div>
      </div>
    </div>

    <!-- Empty state -->
    <div class="empty-state" *ngIf="tareas.length === 0 && !mostrarFormulario">
      <p>No hay tareas en este proyecto</p>
      <button class="btn-crear-primera" (click)="mostrarFormNuevo()">
        Crear primera tarea
      </button>
    </div>
  </div>
</div>